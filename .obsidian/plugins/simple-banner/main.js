/** 
 * Simple Banner v0.5.5
 * @author Sandro Ducceschi
 * @url https://eatcodeplay.dev
 */
var C=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var J=(g,l)=>{for(var e in l)C(g,e,{get:l[e],enumerable:!0})},Q=(g,l,e,i)=>{if(l&&typeof l=="object"||typeof l=="function")for(let t of _(l))!G.call(g,t)&&t!==e&&C(g,t,{get:()=>l[t],enumerable:!(i=X(l,t))||i.enumerable});return g};var Z=g=>Q(C({},"__esModule",{value:!0}),g);var ae={};J(ae,{default:()=>A});module.exports=Z(ae);var k=require("obsidian");var y=require("obsidian");var T={desktop:{bannerEnabled:!0,height:240,viewOffset:0,noteOffset:-32,bannerRadius:[8,8,8,8],bannerPadding:8,bannerFade:!0,iconEnabled:!1,iconSize:96,iconRadius:8,iconBackground:!0,iconBorder:2,iconAlignment:["flex-start","flex-end"],iconOffset:[0,-24],datetimeEnabled:!1,datetimeOnPropOnly:!1,datetimeAlignment:["flex-end","flex-start"],datetimeOffset:[0,0],datetimeTimeFormat:"HH:mm",datetimeDateFormat:"dddd, MMMM Do YYYY",interop:{}},tablet:{bannerEnabled:!0,height:190,viewOffset:0,noteOffset:-32,bannerRadius:[8,8,8,8],bannerPadding:8,bannerFade:!0,iconEnabled:!1,iconSize:96,iconRadius:8,iconBackground:!0,iconBorder:2,iconAlignment:["flex-start","flex-end"],iconOffset:[0,-24],datetimeEnabled:!1,datetimeOnPropOnly:!1,datetimeAlignment:["flex-end","flex-start"],datetimeOffset:[0,0],datetimeTimeFormat:"HH:mm",datetimeDateFormat:"dddd, MMMM Do YYYY",interop:{}},phone:{bannerEnabled:!0,height:160,viewOffset:0,noteOffset:-32,bannerRadius:[8,8,8,8],bannerPadding:8,bannerFade:!0,iconEnabled:!1,iconSize:56,iconRadius:8,iconBackground:!0,iconBorder:2,iconAlignment:["flex-start","flex-end"],iconOffset:[0,-24],datetimeEnabled:!1,datetimeOnPropOnly:!1,datetimeAlignment:["flex-end","flex-start"],datetimeOffset:[0,0],datetimeTimeFormat:"HH:mm",datetimeDateFormat:"dddd, MMMM Do YYYY",interop:{}},properties:{autohide:!0,image:"banner",icon:"icon",datetime:"datetime"}},R="rotate-ccw",H="Restore default",v=class extends y.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}static get currentDevice(){return y.Platform.isPhone?"phone":y.Platform.isTablet?"tablet":"desktop"}static prepare(e){let i=n=>n&&typeof n=="object"&&!Array.isArray(n),t={...T};for(let n in e)if(e.hasOwnProperty(n)){let a=e[n];i(a)&&t.hasOwnProperty(n)&&i(t[n])?t[n]={...t[n],...a}:t[n]=a}return t}display(){let{containerEl:e}=this;e.empty();let i=v.currentDevice,t=this.plugin.settings[i];this.createBannerSettings(),t.bannerEnabled&&(this.createFrontmatterSettings(),this.createIconSettings(),this.createDatetimeSettings())}createBannerSettings(){let e=v.currentDevice,i=this.plugin.settings[e],t=T[e];this.addToggle({title:"Show simple banner",description:`Enable or disable Simple Banner on your ${e} device.`,refreshOnUpdate:!0},i,"bannerEnabled"),i.bannerEnabled&&(this.addNumber({title:"Height",description:`Height of the Banner on your ${e} device (in pixels).`,placeholder:"Enter a number",resetValue:t.height},i,"height"),this.addNumber({title:"Padding",description:"Padding of the banner from the edges of the note in pixels.",placeholder:"Enter a number",resetValue:t.bannerPadding},i,"bannerPadding"),this.addNumber({title:"Note offset",description:"Move the position of the notes content in pixels.",placeholder:"Enter a number",resetValue:t.noteOffset},i,"noteOffset"),this.addNumber({title:"View offset",description:"Move the position of the view content in pixels.",placeholder:"Enter a number",resetValue:t.viewOffset},i,"viewOffset"),this.addNumber({title:"Border radius",description:"Size of the border radius in pixels.",placeholder:"8",isValueArray:!0,length:4,resetValue:t.bannerRadius,classes:["sbs-grid-radius"]},i,"bannerRadius"),this.addToggle({title:"Fade",description:"Fade the image out towards the content.",classes:["sbs-spacer"]},i,"bannerFade"))}createFrontmatterSettings(){let i=this.plugin.settings;this.addHeading("Frontmatter",["sbs-heading"]),this.addToggle({title:"Autohide frontmatter/properties",description:"Enable or disables the frontmatter/properties autohide feature."},i.properties,"autohide"),this.addText({title:"Banner property",description:"Name of the banner property this plugin will look for in the frontmatter.",placeholder:"Default: banner",resetValue:T.properties.image},i.properties,"image"),this.addText({title:"Icon property",description:"Name of the icon property this plugin will look for in the frontmatter.",placeholder:"Default: icon",resetValue:T.properties.icon},i.properties,"icon"),this.addText({title:"Datetime property",description:"Name of the datetime property this plugin will look for in the frontmatter.",placeholder:"Default: datetime",resetValue:T.properties.datetime,classes:["sbs-spacer"]},i.properties,"datetime")}createIconSettings(){let e=v.currentDevice,i=this.plugin.settings[e],t=T[e];this.addHeading("Icon",["sbs-heading"]),this.addToggle({title:"Show icon",description:"Enable or disable the icon.",refreshOnUpdate:!0},i,"iconEnabled"),i.iconEnabled&&(this.addNumber({title:"Icon size",description:"Size of the icon in pixels.",placeholder:"Enter a number",resetValue:t.iconSize},i,"iconSize"),this.addToggle({title:"Icon background",description:"Enable or disable the icon background."},i,"iconBackground"),this.addNumber({title:"Border size",description:"Size of the border in pixels.",placeholder:"Enter a number",resetValue:t.iconBorder},i,"iconBorder"),this.addNumber({title:"Border radius",description:"Size of the border radius in pixels.",placeholder:"Enter a number",resetValue:t.iconRadius},i,"iconRadius"),this.addDropdown({title:"Icon alignment - horizontal",description:"Horizontal alignment of the icon.",choices:[{label:"Left",value:"flex-start"},{label:"Middle",value:"center"},{label:"Right",value:"flex-end"}],resetValue:t.iconAlignment[0]},i,"iconAlignment",0),this.addDropdown({title:"Icon alignment - vertical",description:"Vertical alignment of the icon.",choices:[{label:"Top",value:"flex-start"},{label:"Middle",value:"center"},{label:"Bottom",value:"flex-end"}],resetValue:t.iconAlignment[1]},i,"iconAlignment",1),this.addNumber({title:"Icon offset",description:"Offset the X and Y position of the icon in pixels",placeholder:"0",isValueArray:!0,length:2,resetValue:t.iconOffset,classes:["sbs-grid-xy","sbs-spacer"]},i,"iconOffset"))}createDatetimeSettings(){let e=v.currentDevice,i=this.plugin.settings[e],t=T[e];this.addHeading("Datetime",["sbs-heading"]),this.addToggle({title:"Show datetime",description:"Enable or disable the display of a datetime.",refreshOnUpdate:!0},i,"datetimeEnabled"),i.datetimeEnabled&&(this.addToggle({title:"Only with property",description:"Show datetime only when a property is set in the note"},i,"datetimeOnPropOnly"),this.addText({title:"Time formatting",description:(0,y.sanitizeHTMLToDom)('Define how time should be displayed. Leave empty to disable.<br/>Obsidian uses moment.js for formatting. <a href="https://momentjs.com/docs/#/displaying/format/" target="_blank">Learn more</a>'),placeholder:"Default: HH:mm:ss",allowEmpty:!0,resetValue:t.datetimeTimeFormat},i,"datetimeTimeFormat"),this.addText({title:"Date formatting",description:(0,y.sanitizeHTMLToDom)('Define how the date should be displayed. Leave empty to disable.<br/>Obsidian uses moment.js for formatting. <a href="https://momentjs.com/docs/#/displaying/format/" target="_blank">Learn more</a>'),placeholder:"Default: dddd, MMMM Do YYYY",allowEmpty:!0,resetValue:t.datetimeDateFormat},i,"datetimeDateFormat"),this.addDropdown({title:"Datetime alignment - horizontal",description:"Horizontal alignment of the datetime.",choices:[{label:"Left",value:"flex-start"},{label:"Middle",value:"center"},{label:"Right",value:"flex-end"}],allowEmpty:!0,resetValue:t.datetimeAlignment[0]},i,"datetimeAlignment",0),this.addDropdown({title:"Datetime alignment - vertical",description:"Vertical alignment of the datetime.",choices:[{label:"Top",value:"flex-start"},{label:"Middle",value:"center"},{label:"Bottom",value:"flex-end"}],resetValue:t.datetimeAlignment[1]},i,"datetimeAlignment",1),this.addNumber({title:"Datetime offset",description:"Offset the X and Y position of the datetime in pixels",placeholder:"0",isValueArray:!0,length:2,resetValue:t.datetimeOffset,classes:["sbs-grid-xy","sbs-spacer"]},i,"datetimeOffset"))}addHeading(e,i){let t=new y.Setting(this.containerEl).setHeading().setName(e);this.setClasses(t,i)}addToggle(e,i,t){let n=new y.Setting(this.containerEl);e.title&&n.setName(e.title),e.description&&n.setDesc(e.description),this.setClasses(n,e.classes),n.addToggle(a=>a.setValue(i[t]).onChange(async s=>{i[t]=s,await this.plugin.saveSettings(),e.refreshOnUpdate&&this.display()}))}addDropdown(e,i,t,n){let a=e.resetValue!==void 0,s=e.resetValue,r=new y.Setting(this.containerEl),o=n!==void 0;e.title&&r.setName(e.title),e.description&&r.setDesc(e.description),this.setClasses(r,e.classes),a&&r.addExtraButton(d=>d.setIcon(R).setTooltip(H).onClick(async()=>{o?i[t][n]=s:i[t]=s,await this.plugin.saveSettings(),this.display()})),r.addDropdown(d=>(((e==null?void 0:e.choices)||[]).forEach(f=>{d.addOption(f.value,f.label)}),o?d.setValue(i[t][n]):d.setValue(i[t]),d.onChange(async f=>{o?i[t][n]=f:i[t]=f,await this.plugin.saveSettings()}),d))}addText(e,i,t){let n=e.resetValue!==void 0,a=e.resetValue,s=new y.Setting(this.containerEl);e.title&&s.setName(e.title),e.description&&s.setDesc(e.description),this.setClasses(s,e.classes),n&&s.addExtraButton(r=>r.setIcon(R).setTooltip(H).onClick(async()=>{i[t]=a,await this.plugin.saveSettings(),this.display()})),s.addText(r=>(e.placeholder&&r.setPlaceholder(e.placeholder),r.setValue(i[t].toString()).onChange(async o=>{e.allowEmpty?i[t]=o:i[t]=o!==""?o:a||"",await this.plugin.saveSettings(),e.refreshOnUpdate&&this.display()}),r))}addNumber(e,i,t){let n=e.float,a=e.resetValue!==void 0,s=e.resetValue,r=new y.Setting(this.containerEl);if(e.title&&r.setName(e.title),e.description&&r.setDesc(e.description),this.setClasses(r,e.classes),a&&r.addExtraButton(o=>o.setIcon(R).setTooltip(H).onClick(async()=>{i[t]=e.isValueArray?[...s]:s,await this.plugin.saveSettings(),this.display()})),e.isValueArray&&e.length!==void 0){let o=e.placeholders!==void 0;for(let d=0;d<e.length;d++)r.addText(c=>(o&&(e!=null&&e.placeholders)?c.setPlaceholder(e.placeholders[d]||""):e.placeholder&&c.setPlaceholder(e.placeholder),c.setValue(i[t][d].toString()).onChange(async f=>{let h=n?parseFloat(f):parseInt(f,10);isNaN(h)&&a&&(h=s[d]||0),i[t][d]=h,await this.plugin.saveSettings(),e.refreshOnUpdate&&this.display()}),c))}else r.addText(o=>(e.placeholder&&o.setPlaceholder(e.placeholder),o.setValue(i[t].toString()).onChange(async d=>{let c=n?parseFloat(d):parseInt(d,10);isNaN(c)&&a&&(c=s),i[t]=c,await this.plugin.saveSettings(),e.refreshOnUpdate&&this.display()}),o))}setClasses(e,i){i&&i.forEach(t=>e.setClass(t))}};var M=class{static async migrate(l,e){let i="desktop",t="tablet",n="phone",a={desktopHeight:{target:"desktop.height"},tabletHeight:{target:"tablet.height"},mobileHeight:{target:"phone.height"},offset:{target:"noteOffset",devices:[i,t,n]},fade:{target:"bannerFade",devices:[i,t,n]},radius:{target:"bannerRadius",devices:[i,t,n]},padding:{target:"bannerPadding",devices:[i,t,n]},propertyName:{target:"properties.image"}},s=!1,r={...l};for(let o in a)if(r.hasOwnProperty(o)&&r[o]!==void 0){s=!0;let d=a[o];d.devices?d.devices.forEach(c=>{let f=c+"."+d.target;this.setValueByPath(r,f,r[o])}):this.setValueByPath(r,d.target,r[o]),delete r[o]}return s&&await e.saveData(r),r}static setValueByPath(l,e,i){let t=e.split("."),n=l;for(let a=0;a<t.length-1;a++){let s=t[a];(!n[s]||typeof n[s]!="object")&&(n[s]={}),n=n[s]}n[t[t.length-1]]=i}};var O={},D=class{static get(l){return O[l]||null}static set(l,e){O[l]=e}static delete(l=null){l&&delete O[l]}static exists(l){return O[l]!==void 0}static getAll(){return O}static getIds(){return Object.keys(O)}};var ee,S=class{static init(l){ee=l}static calculateFontsize(l,e){let i=document.createElement("span");i.setAttribute("style","position: absolute; visibility: hidden; white-space: nowrap;"),i.style.padding="0",i.style.margin="0",i.style.left="-9999px",i.textContent=l.toUpperCase(),document.body.appendChild(i);let t=e,n=t-16,a=t;for(i.style.fontSize=a+"px";i.offsetWidth>n&&a>1;)a-=1,i.style.fontSize=a+"px";return document.body.removeChild(i),`${a}px`}static setCSSVariables(l,e=document.body){let i=e.style;Object.keys(l).forEach(t=>{i.setProperty(`--sb-${t}`,l[t])})}};var U=require("obsidian");var B,x={Wikilink:/^!?\[\[([^\]]+?)(\|([^\]]+?))?\]\]$/,Markdown:/^!?\[([^\]]*)\]\(([^)]+?)\)$/,MarkdownBare:/^!?<([^>]+)>$/,Weblink:/^https?:\/\//i},E=class{static init(l){B=l}static async link(l,e,i){let t=null,n=null,a,s=!1,r={x:0,y:0,repeatable:!1},o=l.match(x.Wikilink);o&&(t=o[1].trim(),n=o[3]?o[3].trim():null);let d=l.match(x.Markdown),c=l.match(x.MarkdownBare);if(d?(n=d[1].trim(),t=d[2].trim()):c&&(t=c[1].trim(),n=null),t||(t=l,n=null),a=x.Weblink.test(t),this.isObsidianUrl(t)){let m=t.replace("obsidian://open",""),u=new URLSearchParams(m).get("file");u&&(t=u,s=!0,a=!1,n=null)}let f=t.indexOf("#");if((a||s)&&f!==-1&&(r=this.imageProperties(t.substring(f+1)),t=t.replace(/#.*/,"").trim()),n&&(r=this.imageProperties(n)),!a){let m=B.app.vault,p=null;if(e&&e.file&&(t.includes("../")||t.includes("./")||!t.startsWith("/")&&t.includes("/"))){let u=e.file.path,b=B.app.metadataCache.getFirstLinkpathDest(t,u);b&&(p=b)}if(!p){let u=m.getFiles().filter(b=>b.path===t||b.name===t);p=u.find(b=>b.path===t)||null,p||(p=u.find(b=>b.name===t)||null)}if(p&&(t=m.getResourcePath(p)),s&&p&&e){let u=B.app.workspace.getActiveFile();u&&B.app.fileManager.processFrontMatter(u,b=>{let F=i||B.settingProperties.image;b[F]=`[[${p==null?void 0:p.path}]]`})}}let h=null;try{let m=new URL(t);if(m){let p=m.pathname.split(".").pop(),u=["jpg","jpeg","png","gif","svg","webp"],b=["mp4","webm","ogg","ogv","mov","avi","wmv","mpg","mpeg","3gp"];p&&u.includes(p)?h="image":p&&b.includes(p)&&(h="video")}if(!h){let p=await(0,U.requestUrl)({url:t,method:"HEAD"}),u=(p==null?void 0:p.headers["content-type"])||null;u&&(u.includes("image")?h="image":u.includes("video")&&(h="video"))}}catch(m){console.log(m)}return{url:t.trim(),external:a,type:h,...r}}static imageProperties(l){let e,i=0,t=0;e=l.toLowerCase().includes("repeat");let s=l.split(/x|,/).filter(r=>!isNaN(parseInt(r.trim(),10)));return s.length===2?(i=parseInt(s[0].trim(),10),t=parseInt(s[1].trim(),10)):s.length===1&&(t=parseInt(s[0].trim(),10)),{x:i,y:t,repeatable:e}}static async icon(l,e){let i=l||"",t={value:null,type:"text"};if(x.Wikilink.test(i)?t.type="link":x.Markdown.test(i)||x.MarkdownBare.test(i)?t.type="link":x.Weblink.test(l)?t.type="link":this.isObsidianUrl(l)&&(t.type="link"),t.type==="link"){let n=await this.link(i,e,B.settingProperties.icon);t.value=n.url}else t.value=i;return t}static async isImagePropertiesUpdate(l,e,i){if(!l||!e)return!1;let t=await this.link(l,i),n=await this.link(e,i);return t.url===n.url}static isObsidianUrl(l){return l.startsWith("obsidian://open")}};var w=class{constructor(l,e){this.plugin=l,this.settings=e}};var Y=`.${"simple-banner"}`,I=class extends w{constructor(l,e){super(l,e)}destroy(){}update(l,e,i){let{isImageChange:t,isImagePropsUpdate:n}=l,a=[];return i.forEach(s=>{var o;let r=s.querySelector(Y)||document.createElement("div");if(r.classList.add("simple-banner"),a.push(r),t||n){t&&(r.classList.remove("static"),(o=r.firstChild)==null||o.remove());let d={"img-x":`${e.x}px`,"img-y":`${e.y}px`,size:e.repeatable?"auto":"revert-layer",repeat:e.repeatable?"repeat":"revert-layer",url:"none"};if(e.type==="video"){let c=document.createElement("video");c.controls=!1,c.autoplay=!0,c.muted=!0,c.loop=!0,c.src=e.url,r.appendChild(c),d.url="none"}else d.url=`url(${e.url})`;S.setCSSVariables(d,s)}}),a}inject(l,e){e.forEach((i,t)=>{let n=l[t];i.prepend(n),n.onanimationend=()=>{document.querySelectorAll(Y).forEach(s=>s.classList.add("static"))}})}replace(l){l.forEach(e=>{e.classList.add("static")})}};var q=require("obsidian");var P=class extends w{constructor(l,e){super(l,e)}destroy(){}async update(l,e){let{iconEnabled:i,iconSize:t}=this.settings,n=null;for(let a=0,s=e.length;a<s;a+=1){let r=e[a],{icon:o,view:d}=l,c=r.querySelector(`.${"icon"}`)||null,f=c!==null;if(f&&(c==null||c.classList.add("static")),i&&o){if(!f){c=document.createElement("div"),c.classList.add("icon"),q.Platform.isWin&&c.classList.add("is-windows");let b=document.createElement("div");c.appendChild(b),r.prepend(c)}let h=c==null?void 0:c.querySelector("div"),{value:m,type:p}=await E.icon(o,d);m=(m==null?void 0:m.replace(/([#.:[\\]"])/g,"\\$1"))||"",h.dataset.type=p;let u={};u["icon-value"]=p==="link"?`url(${m})`:`"${m}"`,p==="text"&&(n=n||S.calculateFontsize(m,t),u["icon-fontsize"]=n),S.setCSSVariables(u,h)}else f&&(l.icon=null,c==null||c.remove())}}};var z=require("obsidian");var $=`.${"simple-banner"} > div.${"date-time"}`,V=class extends w{constructor(e,i){super(e,i);this.processTime()}destroy(){window.clearInterval(this.intervalId)}update(e,i){let{datetimeEnabled:t,datetimeOnPropOnly:n}=this.settings,{datetime:a}=e;t?i.forEach(s=>{let r=s.querySelector(`.${"date-time"}`)||null,o=r!==null;if(o&&(r==null||r.classList.add("static")),t&&!n||t&&n&&a){if(!o){r=document.createElement("div"),r.classList.add("date-time");let c=document.createElement("time");r.appendChild(c),s.prepend(r)}let d=r==null?void 0:r.querySelector("time");d.classList.remove("static"),a?(d.classList.add("static"),this.updateTime([d],a,!0)):n||this.updateTime([d])}else o&&(r==null||r.remove())}):document.querySelectorAll($).forEach(r=>{r.remove()})}check(){let e=this.intervalId,{datetimeEnabled:i,datetimeOnPropOnly:t}=this.settings;if(i&&!t){let n=document.querySelectorAll($).length;n===0&&e!==void 0?(window.clearInterval(this.intervalId),this.intervalId=void 0):n>0&&e===void 0&&(this.intervalId=window.setInterval(()=>this.processTime(),1e3))}}processTime(){let{datetimeEnabled:e,datetimeOnPropOnly:i,datetimeTimeFormat:t,datetimeDateFormat:n}=this.settings,a=t!=="",s=n!=="";if(e&&!i){let r=(0,z.moment)();this.time=a?r.format(t):"",this.date=s?r.format(n):"",this.iso=r.toISOString(),this.updateTime()}}updateTime(e,i,t){let{datetimeEnabled:n,datetimeTimeFormat:a,datetimeDateFormat:s}=this.settings,r=a!=="",o=s!=="";if(n){let{time:d,date:c,iso:f}=this;if(i){let m=(0,z.moment)(i);d=r?m.format(a):"",c=o?m.format(s):"",i.includes("T")||(d=""),f=m.toISOString()}let h=e||document.querySelectorAll(`${$} > time`);h.length>0&&h.forEach(m=>{var u;if(((u=m.children)==null?void 0:u.length)===0)m.createEl("span",{text:d}),m.createEl("span",{text:c});else if(!m.classList.contains("static")||t){let b=m.querySelectorAll("span"),F=[d,c];b.forEach((W,K)=>{W.textContent=F[K]||""})}m.setAttribute("datetime",f||"")})}}};var L=class extends w{constructor(l,e){super(l,e)}destroy(){}update(l,e){}check(){}};var A=class extends k.Plugin{async onload(){let e=this.app,i=e.workspace;E.init(this),S.init(this),await this.loadSettings(),this.addSettingTab(new v(e,this)),this.featBanner=new I(this,this.deviceSettings),this.featIcon=new P(this,this.deviceSettings),this.featDatetime=new V(this,this.deviceSettings),this.featPluginInterop=new L(this,this.deviceSettings),i.onLayoutReady(()=>{this.registerEvent(i.on("layout-change",this.handleLayoutChange.bind(this))),this.registerEvent(i.on("file-open",this.handleFileOpen.bind(this))),this.registerEvent(e.metadataCache.on("changed",this.handleMetaChange.bind(this))),this.applySettings()})}onunload(){let{featBanner:e,featIcon:i,featDatetime:t,featPluginInterop:n}=this;e.destroy(),i.destroy(),t.destroy(),n.destroy()}processAll(){this.app.workspace.iterateRootLeaves(e=>{let i=e.view;if(i)if(this.deviceSettings.bannerEnabled){let t=(i==null?void 0:i.file)||null;this.process(t,i)}else this.remove()})}async process(e,i){let t=await this.compute(e,i);if(t){if(!t.image){this.remove(t);return}t.icon||(t.needsUpdate=!0),this.deviceSettings.bannerEnabled&&this.render(t)}}async compute(e,i){let t=i||this.getActiveView();if(e&&t instanceof k.MarkdownView){let n=this.createDefaultBannerData(),a=D.get(t==null?void 0:t.leaf.id)||n,s=this.createDefaultBannerData(t,a.viewMode),r=this.app.metadataCache.getFileCache(e),o=r==null?void 0:r.frontmatter;if(o){let d=this.settingProperties,c=d.image,f=d.icon,h=d.datetime;o[c]&&(s.image=o[c],s.filepath=e.path,a.filepath!==s.filepath?(s.needsUpdate=!0,s.isImageChange=!0):a.image!==s.image&&(s.needsUpdate=!0,s.isImageChange=!0,await E.isImagePropertiesUpdate(a.image,s.image,t)&&(s.isImagePropsUpdate=!0,s.isImageChange=!1))),this.deviceSettings.iconEnabled&&(o[f]?(s.icon=o[f],s.filepath=e.path,a.icon!==s.icon&&(s.needsUpdate=!0)):a.icon&&(s.icon=null,s.needsUpdate=!0)),this.deviceSettings.datetimeEnabled&&(o[h]?(s.datetime=o[h],s.filepath=e.path,a.datetime!==s.datetime&&(s.needsUpdate=!0)):a.datetime&&(s.datetime=null,s.needsUpdate=!0))}return s}return null}async render(e){let{image:i,viewMode:t,lastViewMode:n,view:a,needsUpdate:s,isImageChange:r}=e,o=a==null?void 0:a.containerEl;if(o&&(n!==t||s)){let d=o.querySelectorAll(".cm-scroller, .markdown-reading-view > .markdown-preview-view"),c=await E.link(i||"",a),{featBanner:f,featIcon:h,featDatetime:m,featPluginInterop:p}=this,u=f.update(e,c,d);h.update(e,u),m.update(e,u),p.update(e,u),r?f.inject(u,d):f.replace(u),m.check(),e.lastViewMode=t,o.dataset.sb="",D.set(a==null?void 0:a.leaf.id,e)}}remove(e){let i=(e==null?void 0:e.view)||this.getActiveView();if(i instanceof k.MarkdownView){let t=i==null?void 0:i.containerEl;t&&(t.querySelectorAll(`.${"simple-banner"}`).forEach(a=>{a.remove()}),this.updateMetaDOM(!0),D.delete(i==null?void 0:i.leaf.id),delete t.dataset.sb)}}async loadSettings(){let e=await this.loadData(),i=v.prepare(e);this.settings=await M.migrate(i,this),this.deviceSettings=this.settings[v.currentDevice],this.settingProperties=this.settings.properties}async saveSettings(){await this.saveData(this.settings),this.applySettings()}applySettings(){let e=this.deviceSettings,i=e.height,t=e.noteOffset,n=e.viewOffset,a=e.bannerRadius,s=e.bannerPadding,r=e.bannerFade,o={};if(o.height=`${i}px`,o["note-offset"]=`${t}px`,o["view-offset"]=`${n}px`,o.radius=`${a[0]}px ${a[1]}px ${a[2]}px ${a[3]}px`,o.padding=`${s}px`,o.mask=r?"revert-layer":"initial",e.iconEnabled){let d=e.iconSize,c=e.iconRadius,f=e.iconBackground,h=e.iconBorder,m=e.iconAlignment,p=e.iconOffset;o["icon-size-w"]=`${d}px`,o["icon-size-h"]=`${d}px`,o["icon-radius"]=`${c}px`,o["icon-align-h"]=m[0],o["icon-align-v"]=m[1],o["icon-offset-x"]=`${p[0]}px`,o["icon-offset-y"]=`${p[1]}px`,o["icon-border"]=`${h}px`,o["icon-background"]=f?"revert-layer":"transparent"}if(e.datetimeEnabled){let d=e.datetimeAlignment,c=e.datetimeOffset;o["dt-align-h"]=d[0],o["dt-align-v"]=d[1],o["dt-offset-x"]=`${c[0]}px`,o["dt-offset-y"]=`${c[1]}px`}S.setCSSVariables(o),this.settings.properties.autohide?document.body.classList.add("sb-autohide"):document.body.classList.remove("sb-autohide"),this.processAll()}handleLayoutChange(){let e=this.getActiveView();e?(this.updateMetaDOM(),D.exists(e==null?void 0:e.leaf.id)||this.process(e.file,e)):D.delete(this.getMostRecentLeafId()),this.featDatetime.check()}handleFileOpen(e){let i=this.getActiveView();i instanceof k.MarkdownView&&(this.process(e,i),this.updateMetaDOM())}handleMetaChange(e){this.app.workspace.iterateRootLeaves(i=>{let t=i.view;t.file===e&&this.process(e,t)})}updateMetaDOM(e=!1){if(this.settings.properties.autohide){let i=document.querySelectorAll(".workspace-leaf-content[data-sb] .inline-title"),t=document.querySelectorAll(".workspace-leaf-content[data-sb] .metadata-container");i.length>0&&t.length>0&&i.forEach((n,a)=>{e?n.after(t[a]):n.before(t[a])})}}getActiveView(){return this.app.workspace.getActiveViewOfType(k.MarkdownView)||null}getMostRecentLeafId(){return this.app.workspace.getMostRecentLeaf().id}createDefaultBannerData(e,i){let t=null;return e&&(t=(e.getMode()||null)==="preview"?"preview":"source"),{filepath:null,image:null,icon:null,datetime:null,viewMode:t,lastViewMode:i||null,isImagePropsUpdate:!1,isImageChange:!1,needsUpdate:!1,view:e}}};

/* nosourcemap */